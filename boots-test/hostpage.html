<html>
    <head>
        <title>test</title>
    </head>
    <body>
        <iframe class="myframe" src="./innerframe.html" onload="registerListener()"></iframe>
    </body>
    <script>

        //
        // messages
        //
        const g_messages = {
            "hello": doHelloMsg
        }

        function doHelloMsg(content) {
            const pageInfo = {
                badgecount: 1337,
                bgcolor: "rgb(1,2,3)",
                postid: "post12345",
                username: "avsdoda",
            };
            return {message: "hello", content: pageInfo};
        }

        function registerListener() {
            window.addEventListener(
                "message",
                (event) => {
                    // if (event.origin !== "https://forum.starmen.net/") return;
                    console.log(event.data);
                    
                    for (const [cmd, func] of Object.entries(g_messages)) {
                        if (event.data.message == cmd) {
                            const response = func(event.data.content);
                            if (response !== null) {
                                event.source.postMessage(response, "*");
                            }
                        }
                    }
                },
                false,
            );
        }

    </script>
</html>